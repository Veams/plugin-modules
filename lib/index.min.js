!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("index",[],n):"object"==typeof exports?exports.index=n():(e.index=e.index||{},e.index.index=n())}(this,function(){return function(e){function n(o){if(t[o])return t[o].exports;var i=t[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),i={},s=[],r={modulesInRegister:[],modulesOnConditions:[],modulesOnInit:[],modulesInContext:[]},a=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.Veams,o=arguments[1];t(this,e),i=n,this.options=o,this.options.internalCacheOnly||(this._cache=s),this.options.internalRegisterOnly||(this._register=r),this.initialize()}return o(e,[{key:"initialize",value:function(){this.queryString="["+this.options.attrPrefix+"-"+this.options.attrName+"]",r.modulesInContext=i.helpers.querySelectorArray(this.queryString),this.options.useMutationObserver&&this.observe(document.body),this.bindEvents()}},{key:"bindEvents",value:function(){var e=this;return i.Vent||this.options.useMutationObserver!==!1?void(i.Vent&&this.options.useMutationObserver===!1&&i.Vent.on(i.EVENTS.DOMchanged,function(n,t){r.modulesInContext=e.getModulesInContext(t),e.options.logs&&console.info("VeamsModules :: Recording new context. When available new modules will be initialised in: ",t),e.registerAll()})):void console.info('VeamsModules :: In order to work with the the ajax handling in VeamsModulesHandler you need to define "useMutationObserver" or use the VeamsVent plugin!')}},{key:"bindConditions",value:function(){var e=this;r.modulesOnConditions.forEach(function(n){n.conditionsListenOn&&n.conditionsListenOn.length&&e.bindCondition(n)})}},{key:"bindCondition",value:function(e){var n=this,t=e.conditionsListenOn.join(" ");i.Vent&&i.Vent.subscribe(t,function(){n.registerConditionalModule(e)})}},{key:"splitUpModules",value:function(){var e=this;r.modulesInRegister.forEach(function(n){e.constructor.isCondition(n)?r.modulesOnConditions.push(n):r.modulesOnInit.push(n)})}},{key:"register",value:function(e){if(!Array.isArray(e))throw new Error("VeamsModules :: You need to pass an array to register()!");r.modulesInRegister=r.modulesInRegister.concat(e),this.splitUpModules(),this.bindConditions(),this.registerAll()}},{key:"registerAll",value:function(){r.modulesInRegister&&(this.registerInitialModules(),this.registerConditionalModules())}},{key:"registerInitialModules",value:function(){var e=this;r.modulesOnInit.forEach(function(n){e.registerOne(n)})}},{key:"registerConditionalModules",value:function(){var e=this;r.modulesOnConditions.forEach(function(n){e.registerConditionalModule(n)})}},{key:"registerConditionalModule",value:function(e){this.constructor.makeConditionCheck(e)?this.registerOne(e):this.unregisterOne(e)}},{key:"registerOne",value:function(e){var n=e.namespace,t=e.domName,o=e.module,i=e.render,s=e.cb,r=e.options,a=n?n:t;if(!o)throw new Error("VeamsModules :: In order to work with register() you need to define a module!");if(!a)throw new Error("VeamsModules :: In order to work with register() you need to define a module!");this.initModules({namespace:a,module:o,render:i,cb:s,options:r})}},{key:"unregisterOne",value:function(e){var n=e.namespace;this.constructor.checkModuleInCache(n,"namespace")===!0&&this.constructor.removeFromCacheByKey(n,"namespace")}},{key:"initModules",value:function(e){var n=this,t=e.namespace,o=e.module,s=e.render,a=e.options,l=e.cb;i.helpers.forEach(r.modulesInContext,function(e,i){n.initModule({el:i,namespace:t,options:a,module:o,render:s,cb:l})})}},{key:"initModule",value:function(e){var n=e.el,t=e.namespace,o=e.options,s=e.module,r=e.render,a=e.cb,l=n.getAttribute(this.options.attrPrefix+"-no-render")||r===!1||!1,u=n.getAttribute(this.options.attrPrefix+"-"+this.options.attrName).split(" ");if(u.indexOf(t)!==-1){if(this.constructor.checkModuleInCache(n,"element",t)===!0)return console.info("VeamsModules :: Element is already in cache and initialized: "),void console.log(n);var d=n.getAttribute(this.options.attrPrefix+"-"+this.options.attrOptions),c=i.helpers.extend(JSON.parse(d),o||{}),m=s,h=new m({el:n,namespace:t,options:c,appInstance:i});this.constructor.addToCache({element:n,module:s,instance:h,namespace:t}),h.willMount&&h.willMount(),l||h.render(),a&&"function"==typeof a&&a(s,c),h.didMount&&h.didMount()}}},{key:"observe",value:function(e){var n=this,t=new MutationObserver(function(e){for(var t=0;t<e.length;++t){for(var o=0;o<e[t].addedNodes.length;++o){var i=e[t].addedNodes[o];if(i instanceof HTMLElement){if(i.getAttribute(n.options.attrPrefix+"-"+n.options.attrName)){var s=i.getAttribute(n.options.attrPrefix+"-"+n.options.attrName);n.options.logs&&console.info("VeamsModules :: Recording a new module with the namespace "+s+" at: ",i);var a=!0,l=!1,u=void 0;try{for(var d,c=r.modulesInRegister[Symbol.iterator]();!(a=(d=c.next()).done);a=!0){var m=d.value;if(m.namespace===s){n.initModule({el:i,module:m.module,namespace:m.namespace});break}}}catch(h){l=!0,u=h}finally{try{!a&&c["return"]&&c["return"]()}finally{if(l)throw u}}}n.getModulesInContext(i).length&&(r.modulesInContext=n.getModulesInContext(i),n.options.logs&&console.info("VeamsModules :: Recording new context. When available new modules will be initialised in: ",i),n.registerAll(),r.modulesInContext=n.getModulesInContext(document))}}for(var f=0;f<e[t].removedNodes.length;++f){var p=e[t].removedNodes[f];p instanceof HTMLElement&&(p.getAttribute(n.options.attrPrefix+"-"+n.options.attrName)&&(n.options.logs&&console.info("VeamsModules :: Recording deletion of module: ",p),n.constructor.removeFromCacheByKey(p),r.modulesInContext=n.getModulesInContext(document)),n.getModulesInContext(p).length&&(r.modulesInContext=n.getModulesInContext(p),n.options.logs&&console.info("VeamsModules :: Recording deletion of DOM element. When available modules will be unbound in ",p),r.modulesInContext.forEach(function(e){n.constructor.removeFromCacheByKey(e)}),r.modulesInContext=n.getModulesInContext(document)))}}});t.observe(e,{childList:!0,subtree:!0})}},{key:"getModulesInContext",value:function(e){return i.helpers.querySelectorArray(this.queryString,e)}}],[{key:"addToCache",value:function(e){var n=e.module,t=e.element,o=e.instance,r=e.namespace;s.push({module:n,element:t,instance:o,namespace:r}),i.Vent&&i.EVENTS.moduleCached&&i.Vent.trigger(i.EVENTS.moduleCached,{module:n,element:t})}},{key:"removeFromCacheByKey",value:function(e){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"element",t=void 0,o=0;o<s.length;o++){var i=s[o];i[n]===e&&(i.instance.willUnmount&&i.instance.willUnmount(),i.instance.unregisterEvents&&i.instance.unregisterEvents(),i.instance.didUnmount&&i.instance.didUnmount(),t=o)}t&&s.splice(t,1)}},{key:"checkModuleInCache",value:function(e){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"element",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,o=!1,i=0;i<s.length;i++){var r=s[i];if(o=void 0!==t?r[n]===e&&r.namespace===t:r[n]===e)break}return o}},{key:"isCondition",value:function(e){var n=e.conditions;return n&&"function"==typeof n}},{key:"makeConditionCheck",value:function(e){var n=e.conditions;if(n&&"function"==typeof n)return n()}}]),e}(),l={options:{DEBUG:!1,attrPrefix:"data-js",attrName:"module",attrOptions:"options",logs:!1,internalCacheOnly:!0,internalRegisterOnly:!1,useMutationObserver:!1},pluginName:"ModulesHandler",initialize:function(e,n){this.options=e.helpers.extend(this.options,n||{}),e.modules=e.modules||new a(e,this.options)}};n["default"]=l,n.Modules=a}])});
//# sourceMappingURL=index.min.js.map