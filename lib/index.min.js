!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("index",[],n):"object"==typeof exports?exports.index=n():(e.index=e.index||{},e.index.index=n())}(this,function(){return function(e){function n(o){if(t[o])return t[o].exports;var i=t[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),s={},r=[],a={modulesInRegister:[],modulesOnConditions:[],modulesOnInit:[],modulesInContext:[]},l=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.Veams,o=arguments[1];t(this,e),s=n,this.options=o,this.options.internalCacheOnly||(this._cache=r),this.options.internalRegisterOnly||(this._register=a),this.initialize()}return i(e,[{key:"initialize",value:function(){this.queryString="["+this.options.attrPrefix+"-"+this.options.attrName+"]",a.modulesInContext=s.helpers.querySelectorArray(this.queryString),this.options.useMutationObserver&&this.observe(document.body),this.bindEvents()}},{key:"bindEvents",value:function(){var e=this;return s.Vent||this.options.useMutationObserver!==!1?void(s.Vent&&this.options.useMutationObserver===!1&&s.Vent.on(s.EVENTS.DOMchanged,function(n,t){a.modulesInContext=e.getModulesInContext(t),e.options.logs&&console.info("VeamsModules :: Recording new context. When available new modules will be initialised in: ",t),e.registerAll()})):void console.info('VeamsModules :: In order to work with the the ajax handling in VeamsModulesHandler you need to define "useMutationObserver" or use the VeamsVent plugin!')}},{key:"bindConditions",value:function(){var e=this;a.modulesOnConditions.forEach(function(n){n.conditionsListenOn&&n.conditionsListenOn.length&&e.bindCondition(n)})}},{key:"bindCondition",value:function(e){var n=this,t=e.conditionsListenOn.join(" ");s.Vent&&s.Vent.subscribe(t,function(){n.registerConditionalModule(e)})}},{key:"splitUpModules",value:function(){var e=this;a.modulesInRegister.forEach(function(n){e.addModuleToCache(n)})}},{key:"addModuleToCache",value:function(e){this.constructor.isCondition(e)?a.modulesOnConditions.push(e):a.modulesOnInit.push(e)}},{key:"register",value:function(e){if(!Array.isArray(e))throw new Error("VeamsModules :: You need to pass an array to register()!");a.modulesInRegister=a.modulesInRegister.concat(e),this.splitUpModules(),this.bindConditions(),this.registerAll()}},{key:"add",value:function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];var i=[].concat(n),s=i[0];return 1===i.length&&"object"!==o(i[0])?void console.error('Veams Modules :: You have to provide an object to add a new module! Received "'+i[0]+'"'):(i.length>1&&(console.info("Veams Modules :: Please use an object as parameter. The initialisation with string parameters is deprecated and will be removed in the upcoming release!"),s={namespace:i[0],module:i[1],options:i[2]||{},render:i[3]||!0}),i.length>4?void console.error("Veams Modules :: Please use an object as parameter!"):(a.modulesInRegister.push(s),this.constructor.isCondition(s)?(s.conditionsListenOn&&s.conditionsListenOn.length&&this.bindCondition(s),this.registerConditionalModule(s)):this.registerOne(s),void this.addModuleToCache(s)))}},{key:"registerAll",value:function(){a.modulesInRegister&&(this.registerInitialModules(),this.registerConditionalModules())}},{key:"registerInitialModules",value:function(){var e=this;a.modulesOnInit.forEach(function(n){e.registerOne(n)})}},{key:"registerConditionalModules",value:function(){var e=this;a.modulesOnConditions.forEach(function(n){e.registerConditionalModule(n)})}},{key:"registerConditionalModule",value:function(e){this.constructor.makeConditionCheck(e)?this.registerOne(e):this.unregisterOne(e)}},{key:"registerOne",value:function(e){var n=e.namespace,t=e.domName,o=e.module,i=e.render,s=e.cb,r=e.options,a=n?n:t;if(!o)throw new Error("VeamsModules :: In order to work with register() or add() you need to define a module!");if(!a)throw new Error("VeamsModules :: In order to work with register() or add() you need to define a module!");this.initModules({namespace:a,module:o,render:i,cb:s,options:r})}},{key:"unregisterOne",value:function(e){var n=e.namespace;this.constructor.checkModuleInCache(n,"namespace")===!0&&this.constructor.removeFromCacheByKey(n,"namespace")}},{key:"initModules",value:function(e){var n=this,t=e.namespace,o=e.module,i=e.render,r=e.options,l=e.cb;s.helpers.forEach(a.modulesInContext,function(e,s){n.initModule({el:s,namespace:t,options:r,module:o,render:i,cb:l})})}},{key:"initModule",value:function(e){var n=e.el,t=e.namespace,o=e.options,i=e.module,r=e.render,a=e.cb,l=n.getAttribute(this.options.attrPrefix+"-no-render")||r===!1||!1,u=n.getAttribute(this.options.attrPrefix+"-"+this.options.attrName).split(" ");if(u.indexOf(t)!==-1){if(this.constructor.checkModuleInCache(n,"element",t)===!0)return console.info("VeamsModules :: Element is already in cache and initialized: "),void console.log(n);var d=n.getAttribute(this.options.attrPrefix+"-"+this.options.attrOptions),c=s.helpers.extend(JSON.parse(d),o||{}),m=i,h=new m({el:n,namespace:t,options:c,appInstance:s});this.constructor.addToCache({element:n,module:i,instance:h,namespace:t}),h.willMount&&h.willMount(),l||h.render(),a&&"function"==typeof a&&a(i,c),h.didMount&&h.didMount()}}},{key:"observe",value:function(e){var n=this,t=new MutationObserver(function(e){for(var t=0;t<e.length;++t){for(var o=0;o<e[t].addedNodes.length;++o){var i=e[t].addedNodes[o];if(i instanceof HTMLElement){if(i.getAttribute(n.options.attrPrefix+"-"+n.options.attrName)){var s=i.getAttribute(n.options.attrPrefix+"-"+n.options.attrName);n.options.logs&&console.info("VeamsModules :: Recording a new module with the namespace "+s+" at: ",i);var r=!0,l=!1,u=void 0;try{for(var d,c=a.modulesInRegister[Symbol.iterator]();!(r=(d=c.next()).done);r=!0){var m=d.value;if(m.namespace===s){n.initModule({el:i,module:m.module,namespace:m.namespace});break}}}catch(h){l=!0,u=h}finally{try{!r&&c["return"]&&c["return"]()}finally{if(l)throw u}}}console.log("modules in context: ",n.getModulesInContext(i).length),n.getModulesInContext(i).length&&(a.modulesInContext=n.getModulesInContext(i),n.options.logs&&console.info("VeamsModules :: Recording new context. When available new modules will be initialised in: ",i),n.registerAll(),a.modulesInContext=n.getModulesInContext(document))}}for(var f=0;f<e[t].removedNodes.length;++f){var p=e[t].removedNodes[f];p instanceof HTMLElement&&(p.getAttribute(n.options.attrPrefix+"-"+n.options.attrName)&&(n.options.logs&&console.info("VeamsModules :: Recording deletion of module: ",p),n.constructor.removeFromCacheByKey(p),a.modulesInContext=n.getModulesInContext(document)),n.getModulesInContext(p).length&&(a.modulesInContext=n.getModulesInContext(p),n.options.logs&&console.info("VeamsModules :: Recording deletion of DOM element. When available modules will be unbound in ",p),a.modulesInContext.forEach(function(e){n.constructor.removeFromCacheByKey(e)}),a.modulesInContext=n.getModulesInContext(document)))}}});t.observe(e,{childList:!0,subtree:!0})}},{key:"getModulesInContext",value:function(e){return s.helpers.querySelectorArray(this.queryString,e)}}],[{key:"addToCache",value:function(e){var n=e.module,t=e.element,o=e.instance,i=e.namespace;r.push({module:n,element:t,instance:o,namespace:i}),s.Vent&&s.EVENTS.moduleCached&&s.Vent.trigger(s.EVENTS.moduleCached,{module:n,element:t})}},{key:"removeFromCacheByKey",value:function(e){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"element",t=void 0,o=0;o<r.length;o++){var i=r[o];i[n]===e&&(i.instance.willUnmount&&i.instance.willUnmount(),i.instance.unregisterEvents&&i.instance.unregisterEvents(),i.instance.didUnmount&&i.instance.didUnmount(),t=o)}t&&r.splice(t,1)}},{key:"checkModuleInCache",value:function(e){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"element",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,o=!1,i=0;i<r.length;i++){var s=r[i];if(o=void 0!==t?s[n]===e&&s.namespace===t:s[n]===e)break}return o}},{key:"isCondition",value:function(e){var n=e.conditions;return n&&"function"==typeof n}},{key:"makeConditionCheck",value:function(e){var n=e.conditions;if(n&&"function"==typeof n)return n()}}]),e}(),u={options:{attrPrefix:"data-js",attrName:"module",attrOptions:"options",logs:!1,internalCacheOnly:!0,internalRegisterOnly:!1,useMutationObserver:!1},pluginName:"ModulesHandler",initialize:function(e,n){this.options=e.helpers.extend(this.options,n||{}),e.modules=e.modules||new l(e,this.options)}};n["default"]=u,n.Modules=l}])});
//# sourceMappingURL=index.min.js.map